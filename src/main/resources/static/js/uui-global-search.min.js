var UUI=UUI||{};UUI.Global_Search=function(){"use strict";function a(){this._search_xhr=null,this._full_results_page=null}return a.prototype.init=function(a,b){var c=this,d=$(".uui-global-search .uui-search");b&&(c._full_results_page=b),d.unbind("keyup paste"),d.on("keyup paste",function(){var b=this,d=$(this).parents(".uui-global-search").find(".dropdown-menu");if(a&&"function"==typeof a){var e=$(this).val().trim();if(e.length<2)return void d.hide();c._search_xhr&&"undefined"!=typeof c._search_xhr.abort&&(c._search_xhr.abort(),c._search_xhr=null),c._search_xhr=a(e),$.when(c._search_xhr).then(function(a,d,f){f&&200!==f.status?console.log("Callback function returned status: "+d):c.show_results(a,e,$(b).parents(".uui-global-search"))})}}),d.unbind("focus"),d.focus(function(){$(this).parents(".uui-header").find(".uui-navigation").hide(),$(this).parents("li:first").prevAll().hide()}),d.unbind("blur"),d.blur(function(){var a=this;setTimeout(function(){$(a).val(""),$(a).parents(".uui-global-search").find(".dropdown-menu").hide(),$(a).one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).parents(".uui-header").find(".uui-navigation").show(),$(this).parents("li:first").prevAll().show()})},200)}),$(".uui-global-search .menu-scroll").mCustomScrollbar();var e=$(".responsive-global-search"),f=$(".all-results");f.is(":visible")?(e.find(".menu-scroll").css("height",$(window).height()-$("header").height()-f.height()),e.find(".menu-scroll").mCustomScrollbar()):(e.find(".menu-scroll").css("height",$(window).height()-$("header").height()),e.find(".menu-scroll").mCustomScrollbar());var g=$(".search-icon"),h=$(".hide-search"),i=$(".responsive-global-search .uui-search"),j=i.parents(".responsive-global-search").find(".list-wrapper");g.find("a").unbind("click"),g.find("a").click(function(){$(this).parents("nav").find(".responsive-global-search").show(),i.focus()}),h.unbind("click"),h.click(function(){$(this).parents("nav").find(".responsive-global-search").hide(),i.val(""),j.hide()}),i.unbind("keyup paste"),i.on("keyup paste",function(){var b=this;if(j=$(this).parents(".responsive-global-search").find(".list-wrapper"),a&&"function"==typeof a){var d=$(this).val().trim();if(d.length<2)return void j.hide();c._search_xhr&&"undefined"!=typeof c._search_xhr.abort&&(c._search_xhr.abort(),c._search_xhr=null),c._search_xhr=a(d),$.when(c._search_xhr).then(function(a,e,f){f&&200!==f.status?console.log("Callback function returned status: "+e):c.show_responsive_results(a,d,$(b).parents(".responsive-global-search"))})}}),$(window).resize(function(){f.is(":visible")?e.find(".menu-scroll").css("height",$(window).height()-$("header").height()-f.height()):e.find(".menu-scroll").css("height",$(window).height()-$("header").height()),e.find(".no-results").css("height",$(window).height()-i.find(".search-header").height())})},a.prototype.show_results=function(a,b,c){var d=this;if("[object Array]"!==Object.prototype.toString.call(a))return void console.log("Search results have wrong format.");var e=c.find(".search-links"),f=e.parents(".dropdown-menu").first();e.empty(),f.hide();var g=f.find(".all-results"),h=g.find("a");if(0===a.length){var i=$("<li />").addClass("no-results").show(),j=$("<img />").attr("src","/images/icons/no-results.png"),k=$("<h4 />").text("Whoops"),l=$("<p />").text("No results found");i.append(j).append(k).append(l),e.append(i),g.hide()}else{var m=new RegExp("("+b.split(" ").join("|")+")","gi");a.forEach(function(a){var b=$("<li />"),c=$("<a />").attr("href",a.link),d=$("<p />").addClass("title").text(a.title);a.description.length>175&&(a.description=a.description.substring(0,175)+"...");var f=$("<p />").addClass("description").html(a.description.replace(/</,"&lt;").replace(/>/,"&gt;").replace(m,"<strong>$1</strong>"));c.append(d).append(f),b.append(c),e.append(b)}),d._full_results_page?(h.text(a.length+" results found. View all."),h.attr("href",d._full_results_page+b),g.show()):g.hide()}c.find(".uui-search:focus").length>0&&f.show()},a.prototype.show_responsive_results=function(a,b,c){var d=this;if("[object Array]"!==Object.prototype.toString.call(a))return void console.log("Search results have wrong format.");var e=c.find(".search-links"),f=e.parents(".list-wrapper").first();e.empty(),f.hide();var g=f.find(".all-results"),h=g.find("a");if(0===a.length){var i=$("<li />").addClass("no-results").show(),j=$("<div />").addClass("no-results-content"),k=$("<div />").addClass("no-results-footer"),l=$("<img />").attr("src","/images/icons/no-results-responsive.png"),m=$("<h4 />").text("Whoops"),n=$("<p />").text("No results found"),o=$("<a />").attr("href","#").append('<i class="fa fa-angle-left"></i>Back to...').click(function(a){a.preventDefault();var b=c.find(".uui-search");b.val("").focus(),i.remove(),g.hide(),f.hide()});i.append(j.append(l).append(m).append(n)).append(k.append(o)),e.append(i),g.hide(),c.find(".no-results").css("height",$(window).height()-c.find(".search-header").height())}else{var p=new RegExp("("+b.split(" ").join("|")+")","gi");a.forEach(function(a){var b=$("<li />").click(function(){setTimeout(function(){c.hide(),c.find(".uui-search").val(""),f.hide()},200)}),d=$("<a />").attr("href",a.link),g=$("<p />").addClass("title").text(a.title);a.description.length>175&&(a.description=a.description.substring(0,175)+"...");var h=$("<p />").addClass("description").html(a.description.replace(/</,"&lt;").replace(/>/,"&gt;").replace(p,"<strong>$1</strong>"));d.append(g).append(h),b.append(d),e.append(b)}),d._full_results_page?(h.text(a.length+" results found. View all."),h.attr("href",d._full_results_page+b),h.click(function(){c.hide(),c.find(".uui-search").val(""),f.hide()}),g.show()):g.hide()}c.find(".uui-search:focus").length>0&&f.show()},new a}();